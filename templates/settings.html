{% extends "base.html" %}
{% set title = "Settings" %}

{% block content %}

<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">

    <div class="card shadow-sm">
      <div class="card-body">

        <h4 class="card-title mb-3">Account & Invoice Settings</h4>

        <p class="text-muted small">
          Your email is used for login recovery. Business information appears at the top of your PDF invoices.
        </p>

        <!-- IMPORTANT: multipart for file upload -->
        <form method="post" enctype="multipart/form-data">

          <!-- Email (required) -->
          <div class="mb-3">
            <label class="form-label req">
              Email Address
            </label>
            <input
              type="email"
              class="form-control"
              name="email"
              value="{{ u.email or '' }}"
              required
            >
            <div class="small-muted mt-1">
              Used for password resets.
            </div>
          </div>

          <!-- Profession / Template -->
          <div class="mb-3">
            <label class="form-label req">Business Type / Profession</label>
            <select class="form-select" name="invoice_template" required>
              {% for key, cfg in templates.items() %}
                <option value="{{ key }}"
                  {% if (u.invoice_template or 'auto_repair') == key %}selected{% endif %}>
                  {{ cfg.label }}
                </option>
              {% endfor %}
            </select>
            <div class="small-muted mt-1">
              New invoices will use this style. Existing invoices keep the style they were created with.
            </div>
          </div>

          <hr class="my-4" />

          <!-- Business Name -->
          <div class="mb-3">
            <label class="form-label">
              Business Name / Your Name
            </label>
            <input
              type="text"
              class="form-control"
              name="business_name"
              value="{{ u.business_name or '' }}"
              placeholder="e.g. Charlie Melnarik Automotive"
            >
          </div>

          <!-- Phone -->
          <div class="mb-3">
            <label class="form-label">
              Phone Number
            </label>
            <input
              type="text"
              class="form-control"
              name="phone"
              value="{{ u.phone or '' }}"
              placeholder="(406) 555-1234"
            >
          </div>

          <!-- Address -->
          <div class="mb-3">
            <label class="form-label">
              Address
            </label>
            <textarea
              class="form-control"
              name="address"
              rows="3"
              placeholder="Street, City, State ZIP"
            >{{ u.address or '' }}</textarea>
          </div>

          <hr class="my-4" />

          <div class="mb-3">
            <h6 class="mb-2">Scheduler Email Summaries</h6>
            <div class="small-muted">
              Choose how often to receive an email with upcoming appointments. Emails only send when there are
              scheduled appointments in the selected window.
            </div>
          </div>

          <div class="row g-3 align-items-end mb-3">
            <div class="col-md-6">
              <label class="form-label">Summary Frequency</label>
              <select class="form-select" name="schedule_summary_frequency">
                {% set freq = (u.schedule_summary_frequency or 'none') %}
                <option value="none" {% if freq == 'none' %}selected{% endif %}>None</option>
                <option value="day" {% if freq == 'day' %}selected{% endif %}>Day</option>
                <option value="week" {% if freq == 'week' %}selected{% endif %}>Week</option>
                <option value="month" {% if freq == 'month' %}selected{% endif %}>Month</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Summary Start Time (UTC)</label>
              <input
                type="time"
                class="form-control"
                name="schedule_summary_time"
                value="{{ u.schedule_summary_time or '' }}"
              >
              <div class="small-muted mt-1">
                Appointments within the next day/week/month starting at this time are included.
              </div>
            </div>
          </div>

          <hr class="my-4" />

          <!-- Logo Upload -->
          <div class="mb-3">
            <label class="form-label">
              Logo (shown on invoices)
            </label>
            <input
              class="form-control"
              type="file"
              name="logo"
              accept=".png,.jpg,.jpeg"
            >

            <div class="small-muted mt-1">
              Recommended: transparent PNG, about 600px wide. It will be scaled down on the invoice.
            </div>

            {% if u.logo_path %}
              <div class="mt-2">
                <div class="small-muted">Current logo file:</div>
                <div class="mono">{{ u.logo_path }}</div>
              </div>

              <div class="form-check mt-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="1"
                  id="remove_logo"
                  name="remove_logo"
                >
                <label class="form-check-label" for="remove_logo">
                  Remove logo
                </label>
              </div>
            {% endif %}
          </div>

          <div class="d-flex justify-content-between align-items-center mt-4">
            <button type="submit" class="btn btn-primary">
              Save Settings
            </button>

            <a href="{{ url_for('invoices') }}" class="btn btn-outline-secondary">
              Back to Invoices
            </a>
          </div>

        </form>

      </div>
    </div>

  </div>
</div>

{% endblock %}

