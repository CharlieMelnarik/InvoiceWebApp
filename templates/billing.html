{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <div>
    <h1 class="h3 fw-bold mb-1">Billing</h1>
    <div class="subtitle">Manage your subscription and payment details.</div>
  </div>
  <div class="action-group">
    {% if billing_status %}
      <span class="badge text-bg-light border">
        {{ billing_status }}
      </span>
    {% endif %}
    <a class="btn btn-outline-secondary" href="{{ url_for('invoices') }}">
      Back to invoices
    </a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">

    {% if is_subscribed %}
      <p class="mb-3">
        Your subscription is <strong>{{ billing_status }}</strong>.
      </p>

      {% if billing_status == "trialing" %}
        <p class="small-muted mb-3">
          You’re currently on a free trial. You’ll automatically be billed when the trial ends unless you cancel.
        </p>
      {% elif billing_status == "past_due" %}
        <p class="small-muted mb-3">
          Payment failed or is overdue. Please update your payment method to keep access.
        </p>
      {% elif billing_status == "canceled" %}
        <p class="small-muted mb-3">
          Your subscription is canceled. You can resubscribe below to regain access.
        </p>
      {% endif %}

      <form method="post" action="{{ url_for('billing_portal') }}" class="d-inline">
        <button class="btn btn-primary">
          Manage billing
        </button>
      </form>

    {% else %}
      <p class="mb-2">
        Your account does not have an active subscription.
      </p>

      {% if billing_status %}
        <p class="small-muted mb-3">
          Current status: <span class="mono">{{ billing_status }}</span>
        </p>
      {% endif %}

      {% if trial_used %}
        <p class="small-muted mb-3">
          Your free trial has already been used. Subscribing will start immediately (no trial).
        </p>
      {% else %}
        <p class="small-muted mb-3">
          Start a 7-day free trial to unlock invoice creation, PDF exports, and summaries.
        </p>
      {% endif %}

      <form method="post" action="{{ url_for('billing_checkout') }}" class="d-inline">
        <button class="btn btn-primary">
          {% if trial_used %}
            Subscribe now
          {% else %}
            Start 7-day free trial
          {% endif %}
        </button>
      </form>

      <div class="mt-3 small-muted">
        {% if trial_used %}
          You’ll be charged monthly starting immediately.
        {% else %}
          After your trial ends, you’ll be charged monthly to keep using the app.
        {% endif %}
      </div>
    {% endif %}

  </div>
</div>

{% endblock %}


